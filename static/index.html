<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super App | Humoyun Bo'riyev</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
/* --- SCROLLBAR (O'NG TOMON) DIZAYNI --- */
        
        /* 1. Umumiy kengligi (Juda ingichka qilamiz) */
        ::-webkit-scrollbar {
            width: 8px;
        }

        /* 2. Orqa yo'lakchasi (Sayt foni bilan bir xil rangda) */
        ::-webkit-scrollbar-track {
            background: var(--bg-color); 
        }

        /* 3. Harakatlanuvchi tayoqcha (To'q kulrang) */
        ::-webkit-scrollbar-thumb {
            background: #334155; 
            border-radius: 10px; /* Yumaloq burchaklar */
        }

        /* 4. Sichqoncha borganda rangi o'zgaradi (Effekt) */
        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent); /* Bizning moviy rang */
        }
        /* --- RANG VA FON SOZLAMALARI --- */
        :root {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-main: #ffffff;
            --text-muted: #94a3b8;
            --accent: #3b82f6;
            --gradient: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
        }

        /* Light Mode uchun ham Hero qismi qorong'u qolaveradi (Runway stili) */
        .light-mode {
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #0f172a;
            --text-muted: #64748b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; transition: all 0.3s ease; }
        
        body { background-color: var(--bg-color); color: var(--text-main); min-height: 100vh; display: flex; flex-direction: column; }

        /* --- 1. NAVBAR (Tuzatilgan) --- */
        nav {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 5%; width: 100%; position: fixed; top: 0; z-index: 1000;
            background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(15px); /* Xira oyna effekti kuchaytirildi */
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .light-mode nav { background: rgba(255, 255, 255, 0.8); border-bottom: 1px solid rgba(0,0,0,0.1); }

        .logo { font-size: 24px; font-weight: 800; color: white; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .light-mode .logo { color: #3b82f6; }
        
        /* Tugmalar konteyneri (Eng muhim joyi) */
        .nav-links { 
            display: flex; 
            align-items: center; 
            gap: 15px; /* Tugmalar orasidagi masofa */
        }
        
        .nav-btn { 
            background: transparent; border: 1px solid rgba(255,255,255,0.3); 
            padding: 8px 15px; border-radius: 20px; color: white; font-size: 14px; 
            cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 8px;
        }
        .nav-btn:hover { background: rgba(255,255,255,0.1); border-color: white; }
        .light-mode .nav-btn { color: #1e293b; border-color: rgba(0,0,0,0.2); }
        .light-mode .nav-btn:hover { background: rgba(0,0,0,0.05); border-color: #3b82f6; }

        .theme-toggle { 
            width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); 
            border-radius: 50%; cursor: pointer; color: white; transition: 0.3s;
        }
        .theme-toggle:hover { background: rgba(255,255,255,0.2); transform: rotate(15deg); }
        .light-mode .theme-toggle { background: white; border-color: rgba(0,0,0,0.1); color: #f59e0b; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        /* --- 2. HERO SECTION (RUNWAY STYLE) --- */
        .hero-container {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; 
            height: 85vh; /* Deyarli to'liq ekran */
            width: 100%;
            position: relative;
            
            /* ORQA FON RASMI (Shu yerni o'zgartirishingiz mumkin) */
            background: linear-gradient(rgba(15, 23, 42, 0.7), rgba(15, 23, 42, 0.9)), 
                        url('https://images.unsplash.com/photo-1550751827-4bd374c3f58b?q=80&w=2070&auto=format&fit=crop'); 
            background-size: cover;
            background-position: center;
            background-attachment: fixed; /* Parallax effekt */
            
            border-bottom-left-radius: 50px;
            border-bottom-right-radius: 50px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            margin-bottom: 50px;
        }

        .hero-title { 
            font-size: 4.5rem; font-weight: 800; margin-bottom: 20px; line-height: 1.1; color: white;
            text-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .hero-title span { 
            background: linear-gradient(to right, #4ade80, #3b82f6); 
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        /* Yozuv kursor effekti */
        .cursor {
            color: var(--accent);
            animation: blink 1s infinite;
        }
        @keyframes blink { 
            0%, 100% { opacity: 1; } 
            50% { opacity: 0; } 
        }
        .hero-subtitle { 
            font-size: 1.4rem; color: rgba(255,255,255,0.8); max-width: 700px; margin-bottom: 40px; font-weight: 300;
        }

        /* "Boshlash" tugmasi (Runway dagi "Get Started" kabi) */
        .cta-button {
            padding: 15px 40px; background: white; color: black; font-weight: bold; border-radius: 30px; 
            text-decoration: none; font-size: 18px; transition: 0.3s; box-shadow: 0 0 20px rgba(255,255,255,0.3);
        }
        .cta-button:hover { transform: scale(1.05); box-shadow: 0 0 30px rgba(255,255,255,0.5); }

        /* --- 3. TOOLS GRID --- */
        .tools-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px; padding: 0 5% 50px; max-width: 1200px; margin: 0 auto; width: 100%;
            margin-top: -80px; /* Kartalar rasmning ustiga chiqib turadi */
            position: relative; z-index: 10;
        }

        .tool-card {
            background: var(--card-bg); padding: 30px; border-radius: 20px;
            text-align: left; cursor: pointer; border: 1px solid rgba(255,255,255,0.05);
            backdrop-filter: blur(20px); /* Glassmorphism */
        }
        .light-mode .tool-card { border: 1px solid rgba(0,0,0,0.1); box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .tool-card:hover { transform: translateY(-10px); border-color: var(--accent); }

        .tool-icon {
            font-size: 40px; margin-bottom: 20px; color: var(--accent);
            background: rgba(59, 130, 246, 0.1); width: 70px; height: 70px;
            display: flex; align-items: center; justify-content: center; border-radius: 15px;
        }
        
        /* Qolgan stillar (Workspace, Modal) o'zgarishsiz qoladi... */
        .workspace { display: none; padding: 120px 5% 50px; max-width: 1000px; margin: 0 auto; width: 100%; animation: slideUp 0.4s; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .back-btn { margin-bottom: 20px; display: inline-flex; align-items: center; gap: 10px; color: var(--text-muted); cursor: pointer; font-size: 14px; }
        .app-card { background: var(--card-bg); padding: 30px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.05); }
        input, select { width: 100%; padding: 15px; background: var(--bg-color); border: 1px solid var(--text-muted); color: var(--text-main); border-radius: 10px; margin-bottom: 15px; outline: none; }
        .btn-action { width: 100%; padding: 15px; background: var(--gradient); border: none; color: white; border-radius: 10px; font-weight: bold; cursor: pointer; }
        
        /* Modal Stili */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 2000; }
        .modal-content { background: var(--card-bg); padding: 40px; border-radius: 20px; max-width: 500px; width: 90%; text-align: center; position: relative; }
        .close-modal { position: absolute; top: 20px; right: 20px; font-size: 24px; cursor: pointer; color: var(--text-muted); }
    </style>
</head>
<body>

    <nav>
        <div class="logo" onclick="goHome()">[HUMOYUN].Dev</div>
        <div class="nav-links">
            <button class="nav-btn" onclick="openAbout()"><i class="fas fa-user-astronaut"></i> Biz haqimizda</button>
            <button class="theme-toggle" onclick="toggleTheme()"><i class="fas fa-sun" id="theme-icon"></i></button>
        </div>
    </nav>

    <div id="home-view">
        <section class="hero-container">
            <h1 class="hero-title" id="typewriter">
    <span class="cursor">|</span>
</h1>
            <p class="hero-subtitle">
                Sun'iy intellekt, zamonaviy dizayn va kuchli algoritmlar birlashgan makon.
                <br>Xush kelibsiz, men Humoyun Bo'riyev.
            </p>
            <a href="#tools" class="cta-button" onclick="document.querySelector('.tools-grid').scrollIntoView({behavior: 'smooth'})">
                Boshlash <i class="fas fa-arrow-right" style="margin-left: 10px;"></i>
            </a>
        </section>

        <section class="tools-grid" id="tools">
             <div class="tool-card" onclick="openTool('utilities')">
                <div class="tool-icon"><i class="fas fa-qrcode"></i></div>
                <h3>QR Generator</h3>
                <p>Linklarni zamonaviy va rangli QR kodlarga aylantiring.</p>
            </div>
            <div class="tool-card" onclick="openTool('ai-tools')">
                <div class="tool-icon"><i class="fas fa-robot"></i></div>
                <h3>AI Markazi</h3>
                <p>Gemini 2.0 bilan suhbatlashing va yordam oling.</p>
            </div>

            <div class="tool-card" onclick="openTool('design')">
                <div class="tool-icon"><i class="fas fa-layer-group"></i></div>
                <h3>Dizayn Studiya</h3>
                <p>Rasmlar formatini bir zumda PDF yoki PNG ga o'giring.</p>
            </div>
             <div class="tool-card" onclick="openTool('typing-game')">
                <div class="tool-icon"><i class="fas fa-gamepad"></i></div>
                <h3>Cosmic Defender</h3>
                <p>So'zlarni portlatib, galaktikani himoya qiling!</p>
            </div>
        </section>
    </div>

    <div id="utilities" class="workspace">
        <div class="back-btn" onclick="goHome()"><i class="fas fa-arrow-left"></i> Asosiyga qaytish</div>
        <div class="app-card">
            <h2>QR Kod Generator</h2>
            <br>
            <input type="text" id="qr-text" placeholder="Link yoki matn yozing...">
            <button class="btn-action" onclick="generateQR()">Yaratish</button>
            
            <div id="qr-results-area" style="display: none; gap: 20px; margin-top: 30px; justify-content: center; flex-wrap: wrap;">
                <div style="text-align: center;">
                    <p style="margin-bottom: 10px;">Oddiy</p>
                    <img id="img-simple" style="width: 150px; border-radius: 10px;">
                    <a id="btn-simple" class="back-btn" style="display: block; margin-top: 10px; text-align: center;">Yuklab olish</a>
                </div>
                <div style="text-align: center;">
                    <p style="margin-bottom: 10px; color: var(--accent);">Zamonaviy</p>
                    <img id="img-modern" style="width: 150px; border-radius: 10px;">
                    <a id="btn-modern" class="back-btn" style="display: block; margin-top: 10px; text-align: center;">Yuklab olish</a>
                </div>
            </div>
        </div>
    </div>

   <div id="ai-tools" class="workspace">
        <div class="back-btn" onclick="goHome()"><i class="fas fa-arrow-left"></i> Asosiyga qaytish</div>
        
        <div class="app-card" style="height: 75vh; display: flex; flex-direction: column;">
            <h2>AI Yordamchi (Gemini Vision)</h2>
            
            <div id="chat-box" style="flex: 1; overflow-y: auto; padding: 20px; border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; margin: 20px 0;">
                <div style="text-align: center; color: var(--text-muted); margin-top: 50px;">
                    <i class="fas fa-eye" style="font-size: 40px; margin-bottom: 15px;"></i>
                    <p>Rasm yuklang yoki savol bering!</p>
                </div>
            </div>

            <div style="display: flex; gap: 10px; align-items: center; background: var(--bg-color); padding: 10px; border-radius: 15px; border: 1px solid var(--text-muted);">
                
                <input type="file" id="vision-file" accept="image/*" style="display: none;" onchange="showPreview()">
                
                <button onclick="document.getElementById('vision-file').click()" style="background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 20px; padding: 0 10px;">
                    <i class="fas fa-paperclip"></i>
                </button>

                <div id="image-preview" style="display: none; width: 40px; height: 40px; border-radius: 5px; overflow: hidden; border: 1px solid var(--accent);">
                    <img id="preview-img" style="width: 100%; height: 100%; object-fit: cover;">
                </div>

                <input type="text" id="ai-prompt" placeholder="Savol bering..." 
                       style="flex: 1; border: none; background: transparent; padding: 0; margin: 0; color: var(--text-main); outline: none;">
                
                <button onclick="askAI()" class="btn-action" style="width: 50px; padding: 10px; border-radius: 10px; margin-bottom: 0;">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="design" class="workspace">
        <div class="back-btn" onclick="goHome()"><i class="fas fa-arrow-left"></i> Asosiyga qaytish</div>
        <div class="app-card">
            <h2>Universal Rasm Konverter</h2>
            <p style="color: var(--text-muted); margin-bottom: 20px;">Rasmlarni PDF, PNG, JPG formatga o'tkazing.</p>
            
            <input type="file" id="file-upload" accept="image/*" style="padding: 10px;">
            <select id="convert-format">
                <option value="pdf">PDF (Hujjat)</option>
                <option value="png">PNG (Sifatli)</option>
                <option value="jpeg">JPG (Yengil)</option>
                <option value="webp">WEBP (Web saytlar uchun)</option>
            </select>
            <button onclick="convertImage()" class="btn-action">Aylantirish</button>

            <div id="convert-result" style="display: none; margin-top: 20px; text-align: center;">
                <p style="color: #4ade80; margin-bottom: 10px;">Muvaffaqiyat!</p>
                <a id="download-link" class="btn-action" style="display: inline-block; background: #10b981; width: auto; padding: 10px 30px;">Yuklab olish</a>
            </div>
        </div>
    </div>
<div id="typing-game" class="workspace">
        <div class="back-btn" onclick="stopGameAndGoHome()"><i class="fas fa-arrow-left"></i> O'yinni to'xtatish</div>
        
        <div class="app-card" style="padding: 0; overflow: hidden; position: relative; height: 80vh; border: 2px solid var(--accent); background: radial-gradient(circle at bottom, #1e293b 0%, #0f172a 100%);">
            
            <div style="position: absolute; top: 20px; left: 20px; z-index: 10; font-family: 'Courier New', monospace; font-weight: bold;">
                <p style="color: #4ade80; font-size: 20px; text-shadow: 0 0 10px #4ade80;">SCORE: <span id="score">0</span></p>
                <p style="color: #f472b6; font-size: 16px;">LEVEL: <span id="level">1</span></p>
            </div>

            <div style="position: absolute; top: 20px; right: 20px; z-index: 10; color: #ef4444; font-size: 24px;" id="lives-display">
                <i class="fas fa-heart"></i> <i class="fas fa-heart"></i> <i class="fas fa-heart"></i>
            </div>

            <div id="start-screen" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 20;">
                <h1 style="font-size: 60px; color: var(--accent); margin-bottom: 10px; text-shadow: 0 0 20px var(--accent);">COSMIC DEFENDER</h1>
                <p style="color: var(--text-muted); margin-bottom: 30px; font-size: 18px;">So'zlarni yozib, ularni yerga tushishidan oldin portlating!</p>
                <button onclick="startGame()" class="btn-action" style="width: auto; padding: 15px 50px; font-size: 20px; border-radius: 50px; box-shadow: 0 0 20px var(--accent);">
                    <i class="fas fa-play"></i> BOSHLASH
                </button>
            </div>

            <div id="game-over-screen" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.95); flex-direction: column; align-items: center; justify-content: center; z-index: 30;">
                <h1 style="font-size: 50px; color: #ef4444; margin-bottom: 10px;">GAME OVER</h1>
                <p style="font-size: 24px; color: white;">Natija: <span id="final-score">0</span></p>
                <p style="color: var(--text-muted); margin-bottom: 30px;">Yana bir bor urinib ko'rasizmi?</p>
                <button onclick="startGame()" class="btn-action" style="width: auto; padding: 10px 40px;">Qayta o'ynash</button>
            </div>

            <canvas id="gameCanvas" style="display: block; width: 100%; height: 100%;"></canvas>
            
            <audio id="laser-sound" src="/static/click.mp3"></audio>
        </div>
    </div>

    <div id="about-modal" class="modal-overlay">
        <div class="modal-content">
            <span class="close-modal" onclick="closeAbout()">&times;</span>
            <div style="width: 100px; height: 100px; background: var(--gradient); border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-size: 40px; color: white;">
                <i class="fas fa-user"></i>
            </div>
            <h2>Humoyun Bo'riyev</h2>
            <p style="color: var(--accent); margin-bottom: 20px;">Full Stack Developer</p>
            <p style="color: var(--text-muted); line-height: 1.6; text-align: left; margin-bottom: 30px;">
                SAMDU UF "Axborot tizimlari va texnologiyalari" 4-kurs talabasi. 
                Ushbu loyiha Python, FastAPI va zamonaviy Web texnologiyalarini o'rganish maqsadida yaratildi.
            </p>
            <a href="https://t.me/humoyun_19" target="_blank" class="btn-action" style="text-decoration: none; display: inline-block;">
                <i class="fab fa-telegram"></i> @humoyun_19
            </a>
        </div>
    </div>

    <script>
        // --- NAVIGATSIYA LOGIKASI ---
        function goHome() {
            // Hamma "workspace" larni yashiramiz
            document.querySelectorAll('.workspace').forEach(el => el.style.display = 'none');
            // Home ni ko'rsatamiz
            document.getElementById('home-view').style.display = 'block';
        }

        function openTool(toolId) {
            // Home ni yashiramiz
            document.getElementById('home-view').style.display = 'none';
            // Kerakli toolni ochamiz
            document.getElementById(toolId).style.display = 'block';
        }

        // --- MODAL (BIZ HAQIMIZDA) ---
        function openAbout() { document.getElementById('about-modal').style.display = 'flex'; }
        function closeAbout() { document.getElementById('about-modal').style.display = 'none'; }

        // --- THEME (TUZATILGAN: Xotirada saqlash bilan) ---
        
        // 1. Sahifa yuklanganda tekshiramiz
        document.addEventListener("DOMContentLoaded", () => {
            const savedTheme = localStorage.getItem('theme');
            const icon = document.getElementById('theme-icon');
            
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
                if(icon) icon.className = 'fas fa-moon';
            }
        });

        // 2. Tugma bosilganda o'zgartiramiz va saqlaymiz
        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            const isLight = document.body.classList.contains('light-mode');
            
            // Ikonkani o'zgartirish
            const icon = document.getElementById('theme-icon');
            if(icon) icon.className = isLight ? 'fas fa-moon' : 'fas fa-sun';
            
            // Brauzer xotirasiga yozish
            localStorage.setItem('theme', isLight ? 'light' : 'dark');
        }

        // --- FUNCTIONALITY (Oldingi kodlar) ---
        async function generateQR() {
            const text = document.getElementById('qr-text').value;
            if(!text) return alert("Matn kiriting!");
            try {
                const res = await fetch('/api/generate-qr', {
                    method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({text})
                });
                const data = await res.json();
                document.getElementById('img-simple').src = data.url_simple;
                document.getElementById('btn-simple').href = data.url_simple;
                document.getElementById('img-modern').src = data.url_modern;
                document.getElementById('btn-modern').href = data.url_modern;
                document.getElementById('qr-results-area').style.display = 'flex';
            } catch(e) { alert("Xatolik!"); }
        }

       // --- 4. AI CHAT & VISION (YANGILANGAN) ---
        
        // Rasm tanlaganda kichkina ko'rsatish funksiyasi
        function showPreview() {
            const file = document.getElementById('vision-file').files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('preview-img').src = e.target.result;
                    document.getElementById('image-preview').style.display = 'block';
                }
                reader.readAsDataURL(file);
            }
        }

        async function askAI() {
            const input = document.getElementById('ai-prompt');
            const fileInput = document.getElementById('vision-file');
            const chatBox = document.getElementById('chat-box');
            const previewBox = document.getElementById('image-preview');
            
            const text = input.value;
            const file = fileInput.files[0]; // Tanlangan rasm

            if (!text && !file) return; // Hech narsa yo'q bo'lsa to'xta

            // 1. Ekranga chiqarish
            let userHTML = `<div style="text-align:right; margin:10px 0;">`;
            
            // Agar rasm bo'lsa, uni ham chatga chiqaramiz
            if (file) {
                const imgURL = URL.createObjectURL(file);
                userHTML += `<img src="${imgURL}" style="max-width: 150px; border-radius: 10px; margin-bottom: 5px; border: 2px solid var(--accent);"><br>`;
            }
            
            if (text) {
                userHTML += `<span style="background:var(--accent); color:white; padding:8px 15px; border-radius:15px 15px 0 15px; display:inline-block;">${text}</span>`;
            }
            userHTML += `</div>`;
            chatBox.innerHTML += userHTML;
            
            // Inputlarni tozalash
            input.value = '';
            fileInput.value = ''; // Rasmni xotiradan o'chiramiz
            previewBox.style.display = 'none'; // Prevyuni yashiramiz
            chatBox.scrollTop = chatBox.scrollHeight;

            // 2. Yuklanmoqda...
            const loadId = "load-" + Date.now();
            chatBox.innerHTML += `<p id="${loadId}" style="font-size:12px; color:var(--text-muted);">AI ko'rmoqda va o'ylamoqda...</p>`;

            try {
                let response, data;

                // A) Agar rasm bo'lsa -> VISION API ga yuboramiz
                if (file) {
                    const formData = new FormData();
                    formData.append("prompt", text || "Bu rasmda nima bor?"); // Matn bo'lmasa default so'z
                    formData.append("file", file);
                    
                    response = await fetch('/api/chat-with-image', {
                        method: 'POST',
                        body: formData
                    });
                } 
                // B) Agar faqat matn bo'lsa -> ODDIY CHAT API ga yuboramiz
                else {
                    response = await fetch('/api/chat', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({prompt: text})
                    });
                }

                data = await response.json();
                document.getElementById(loadId).remove();
                
                // Javobni formatlash
                let clean = data.response.replace(/\*\*/g, "").replace(/\*/g, "- ");
                chatBox.innerHTML += `<div style="text-align:left; margin:10px 0;"><span style="background:var(--card-bg); padding:10px; border-radius:0 15px 15px 15px; display:inline-block; border:1px solid rgba(255,255,255,0.1); max-width: 80%;">${clean}</span></div>`;
            
            } catch(e) { 
                document.getElementById(loadId).innerText = "Xatolik yuz berdi."; 
                console.log(e);
            }
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        async function convertImage() {
            const input = document.getElementById('file-upload');
            if(input.files.length === 0) return alert("Rasm tanlang!");
            const formData = new FormData();
            formData.append("file", input.files[0]);
            formData.append("format", document.getElementById('convert-format').value);
            
            try {
                const res = await fetch('/api/convert', {method:'POST', body: formData});
                const data = await res.json();
                if(data.url) {
                    const link = document.getElementById('download-link');
                    link.href = data.url; link.download = "converted_image";
                    document.getElementById('convert-result').style.display = 'block';
                }
            } catch(e) { alert("Xatolik!"); }
        }
// --- TYPEWRITER EFFEKTI (OVOZLI ðŸ”Š) ---
        document.addEventListener('DOMContentLoaded', function() {
            const titleElement = document.getElementById('typewriter');
            const cursor = document.querySelector('.cursor');
            
            // 1. Ovoz faylini yuklaymiz
            // Agar fayling static papkada bo'lsa:
            const keySound = new Audio('/static/click.mp3'); 
            keySound.volume = 0.5; // Ovoz balandligi (0.0 dan 1.0 gacha)

            const part1 = "Kelajakni ";
            const part2 = "Kod"; 
            const part3 = " Bilan Yarating";
            
            let i = 0;
            
            function playSound() {
                // Ovozni har safar boshidan chalish uchun
                keySound.currentTime = 0;
                // Brauzer ba'zan avto-ovozni bloklaydi, shuning uchun "catch" qo'shamiz
                keySound.play().catch(e => console.log("Ovoz bloklandi (sahifaga bosing):", e));
            }

            function typeWriter() {
                // 1. Birinchi qism
                if (i < part1.length) {
                    titleElement.insertBefore(document.createTextNode(part1.charAt(i)), cursor);
                    playSound(); // <--- OVOZ CHIQARISH
                    i++;
                    setTimeout(typeWriter, 100); 
                } 
                // 2. Ikkinchi qism (Rangli)
                else if (i < part1.length + part2.length) {
                    let span = titleElement.querySelector('span.accent-text');
                    if (!span) {
                        span = document.createElement('span');
                        span.className = 'accent-text';
                        span.style.background = "linear-gradient(to right, #4ade80, #3b82f6)";
                        span.style.webkitBackgroundClip = "text";
                        span.style.webkitTextFillColor = "transparent";
                        titleElement.insertBefore(span, cursor);
                    }
                    span.textContent += part2.charAt(i - part1.length);
                    playSound(); // <--- OVOZ CHIQARISH
                    i++;
                    setTimeout(typeWriter, 100);
                }
                // 3. Uchinchi qism
                else if (i < part1.length + part2.length + part3.length) {
                    titleElement.insertBefore(document.createTextNode(part3.charAt(i - (part1.length + part2.length))), cursor);
                    playSound(); // <--- OVOZ CHIQARISH
                    i++;
                    setTimeout(typeWriter, 100);
                }
            }
            
            // 1 soniya kutib boshlaymiz
            setTimeout(typeWriter, 1000);
        });
// --- COSMIC DEFENDER (YANGILANGAN VERSIYA v2.0) ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const levelEl = document.getElementById('level');
        const finalScoreEl = document.getElementById('final-score');
        const startScreen = document.getElementById('start-screen');
        const gameOverScreen = document.getElementById('game-over-screen');
        const livesDisplay = document.getElementById('lives-display');

        // SO'ZLAR DARAJALAR BO'YICHA
        const wordsEasy = ["kod", "Ilyosjon", "bolam", "Elyor", "Yakubova", "Humoyun", "kottasidan", "hali", "snekirs", "yiyman", "olma", "nonsiz", "ishsiz", "uysiz"];
        const wordsMedium = ["kitob", "qalam", "maktab", "dastur", "tizim", "server", "python", "java", "html", "script", "loyiha", "tezlik", "ekran", "ovoz"];
        const wordsHard = ["internet", "klavish", "sichqon", "algoritm", "funksiya", "o'zgaruvchi", "interfeys", "dizayn", "grafika", "xavfsizlik", "muvaffaqiyat", "texnologiya", "kelajak", "universitet"];

        let words = [];
        let particles = [];
        let score = 0;
        let level = 1;
        let lives = 3;
        let spawnRate = 2500; // Boshlanishiga sekinroq (2.5 sekund)
        let lastSpawn = 0;
        let animationId;
        let activeWordIndex = -1; 
        let gameActive = false;

        // --- OVOZ GENERATORI (Faylsiz ishlaydi) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'laser') {
                // Lazer ovozi (Yuqori chastota pasayib boradi)
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(800, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.1);
            } else if (type === 'explosion') {
                // Portlash ovozi (Past chastota)
                osc.type = 'square';
                osc.frequency.setValueAtTime(100, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            }
        }

        function resizeCanvas() {
            if(canvas.parentElement) {
                canvas.width = canvas.parentElement.clientWidth;
                canvas.height = canvas.parentElement.clientHeight;
            }
        }
        window.addEventListener('resize', resizeCanvas);

        class Word {
            constructor() {
                // LEVELGA QARAB SO'Z TANLASH
                let pool = wordsEasy;
                if (level >= 3) pool = pool.concat(wordsMedium);
                if (level >= 6) pool = pool.concat(wordsHard); // 6-leveldan keyin qiyinlari qo'shiladi
                
                // Faqat levelga mos uzunlikdagi so'zlarni olish ehtimolini oshiramiz
                if (level < 3) pool = wordsEasy;
                else if (level < 6 && Math.random() > 0.3) pool = wordsMedium; 

                this.text = pool[Math.floor(Math.random() * pool.length)];
                this.x = Math.random() * (canvas.width - 150) + 50;
                this.y = -40;
                
                // TEZLIKNI ASTA OSHIRISH
                // Boshida juda sekin (0.3 - 0.6 px/frame)
                this.speed = Math.random() * (0.3 + level * 0.05) + 0.3; 
                
                this.typedIndex = 0;
                this.color = "#ffffff";
            }

            draw() {
                ctx.font = "bold 26px 'Courier New'";
                // Soya berish (o'qish oson bo'lishi uchun)
                ctx.shadowColor = "black";
                ctx.shadowBlur = 4;
                
                // Yozilgan qismi (Yashil)
                ctx.fillStyle = "#4ade80";
                ctx.fillText(this.text.substring(0, this.typedIndex), this.x, this.y);
                
                // Qolgan qismi (Oq)
                ctx.fillStyle = this.color;
                const offset = ctx.measureText(this.text.substring(0, this.typedIndex)).width;
                ctx.fillText(this.text.substring(this.typedIndex), this.x + offset, this.y);
                
                ctx.shadowBlur = 0; // Soyani o'chirish

                if (words.indexOf(this) === activeWordIndex) {
                    // Nishon belgisi
                    ctx.strokeStyle = "#ef4444"; // Qizil nishon
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(this.x + ctx.measureText(this.text).width / 2, this.y - 8, 30, 0, Math.PI * 2);
                    ctx.stroke();
                }
            }

            update() {
                this.y += this.speed;
            }
        }

        class Particle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 8; // Tezroq sochiladi
                this.vy = (Math.random() - 0.5) * 8;
                this.alpha = 1;
                this.color = `hsl(${Math.random() * 60 + 10}, 100%, 50%)`; // Olov ranglar
            }
            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 4, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.alpha -= 0.03;
            }
        }

        function createExplosion(x, y) {
            playSound('explosion'); // Portlash ovozi
            for (let i = 0; i < 20; i++) {
                particles.push(new Particle(x, y));
            }
        }

        function spawnWord(timestamp) {
            if (timestamp - lastSpawn > spawnRate) {
                words.push(new Word());
                lastSpawn = timestamp;
                // Har bir levelda ozgina tezlashadi, lekin minimal chegara bor
                if (spawnRate > 1000) spawnRate -= 20; 
            }
        }

        function updateLives() {
            let hearts = "";
            for(let i=0; i<lives; i++) hearts += '<i class="fas fa-heart"></i> ';
            livesDisplay.innerHTML = hearts;
            if (lives <= 0) gameOver();
        }

        function drawLaser(targetX, targetY) {
            playSound('laser'); // Lazer ovozi
            ctx.beginPath();
            ctx.moveTo(canvas.width / 2, canvas.height); 
            ctx.lineTo(targetX, targetY);
            ctx.strokeStyle = "#4ade80"; // Yashil lazer
            ctx.lineWidth = 4;
            ctx.shadowBlur = 10;
            ctx.shadowColor = "#4ade80";
            ctx.stroke();
            ctx.shadowBlur = 0;
        }

        function gameLoop(timestamp) {
            if (!gameActive) return;

            ctx.fillStyle = 'rgba(15, 23, 42, 0.4)'; // Trail effekti
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            spawnWord(timestamp);

            words.forEach((word, index) => {
                word.update();
                word.draw();

                if (word.y > canvas.height) {
                    words.splice(index, 1);
                    if (index === activeWordIndex) activeWordIndex = -1;
                    lives--;
                    updateLives();
                    canvas.style.border = "4px solid red";
                    setTimeout(() => canvas.style.border = "2px solid var(--accent)", 200);
                }
            });

            particles.forEach((p, index) => {
                if (p.alpha <= 0) particles.splice(index, 1);
                else { p.update(); p.draw(); }
            });

            animationId = requestAnimationFrame(gameLoop);
        }

        document.addEventListener('keydown', (e) => {
            if (!gameActive) return;
            const key = e.key.toLowerCase();

            if (activeWordIndex === -1) {
                let targetIndex = -1;
                let maxY = -100;

                // Eng pastdagi so'zni ustuvor deb bilamiz
                words.forEach((word, index) => {
                    if (word.text.charAt(0).toLowerCase() === key && word.y > maxY) {
                        maxY = word.y;
                        targetIndex = index;
                    }
                });

                if (targetIndex !== -1) {
                    activeWordIndex = targetIndex;
                    processInput(key);
                }
            } else {
                processInput(key);
            }
        });

        function processInput(key) {
            const word = words[activeWordIndex];
            if (!word) { activeWordIndex = -1; return; } // Xatolik oldini olish

            if (word.text.charAt(word.typedIndex).toLowerCase() === key) {
                word.typedIndex++;
                drawLaser(word.x + 30, word.y); 
                
                if (word.typedIndex === word.text.length) {
                    createExplosion(word.x + 30, word.y);
                    words.splice(activeWordIndex, 1);
                    activeWordIndex = -1;
                    score += 10;
                    scoreEl.innerText = score;
                    
                    if (score % 30 === 0) { // Har 30 ballda level oshadi
                        level++;
                        levelEl.innerText = level;
                    }
                }
            } 
        }

        function startGame() {
            resizeCanvas();
            startScreen.style.display = 'none';
            gameOverScreen.style.display = 'none';
            
            // Audio Contextni yoqish (Foydalanuvchi tugmani bosganda)
            if (audioCtx.state === 'suspended') audioCtx.resume();

            words = [];
            particles = [];
            score = 0;
            level = 1;
            lives = 3;
            spawnRate = 2500;
            activeWordIndex = -1;
            gameActive = true;
            
            scoreEl.innerText = score;
            levelEl.innerText = level;
            updateLives();
            
            animationId = requestAnimationFrame(gameLoop);
        }

        function gameOver() {
            gameActive = false;
            cancelAnimationFrame(animationId);
            finalScoreEl.innerText = score;
            gameOverScreen.style.display = 'flex';
        }

        function stopGameAndGoHome() {
            gameActive = false;
            cancelAnimationFrame(animationId);
            goHome();
        }
    </script>
<footer style="text-align: center; padding: 40px 20px; color: var(--text-muted); font-size: 0.9rem; margin-top: auto;">
        <p>&copy; 2026 Humoyun Bo'riyev. Barcha huquqlar himoyalangan.</p>
        <div style="margin-top: 10px; display: flex; justify-content: center; gap: 20px; font-size: 20px;">
            <a href="#" style="color: var(--text-muted); transition: 0.3s;"><i class="fab fa-github"></i></a>
            <a href="#" style="color: var(--text-muted); transition: 0.3s;"><i class="fab fa-linkedin"></i></a>
            <a href="#" style="color: var(--text-muted); transition: 0.3s;"><i class="fab fa-instagram"></i></a>
        </div>
    </footer>
</body>
</html>